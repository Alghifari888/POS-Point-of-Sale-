# =============================
# 1. NON INDEXING & DEFAULT FILE
# =============================
Options -Indexes
DirectoryIndex index.php index.html

# =============================
# 2. PROTECT .HTACCESS & SENSITIVE FILES
# =============================
<FilesMatch "^(\.htaccess|\.env|composer\.(json|lock)|.*\.bak|.*\.sql)$">
  Order allow,deny
  Deny from all
</FilesMatch>

# =============================
# 3. BLOCK ACCESS TO BACKEND DIR (example: includes/, modules/)
# =============================
RedirectMatch 403 ^/includes/
RedirectMatch 403 ^/modules/
RedirectMatch 403 ^/config/

# =============================
# 4. PROTECT PHP FILES OUTSIDE PUBLIC DIR
# =============================
<Files ~ "\.php$">
  Require all denied
</Files>

# Catatan: kamu bisa override ini di file `.htaccess` dalam folder publik seperti:
# <Directory /your-public-folder>
#     <FilesMatch "\.php$">
#         Require all granted
#     </FilesMatch>
# </Directory>

# =============================
# 5. PREVENT XSS, MIME SNIFFING, IFRAME, ETC
# =============================
<IfModule mod_headers.c>
  Header set X-Content-Type-Options "nosniff"
  Header set X-Frame-Options "SAMEORIGIN"
  Header set X-XSS-Protection "1; mode=block"
  Header always set Referrer-Policy "no-referrer-when-downgrade"
  Header always set Permissions-Policy "geolocation=(), microphone=(), camera=()"
  Header set Content-Security-Policy "default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; object-src 'none'"
</IfModule>

# =============================
# 6. DISABLE UPLOAD EXECUTION (.php, .exe, .sh) in /uploads or user folders
# =============================
# Tambahkan file .htaccess dalam folder uploads/
# Misal: /uploads/.htaccess
#   <FilesMatch "\.(php|php5|php7|sh|pl|py|cgi|exe)$">
#       Order allow,deny
#       Deny from all
#   </FilesMatch>

# =============================
# 7. LIMIT REQUEST SIZE (optional)
# =============================
LimitRequestBody 10485760
# 10 MB upload limit

# =============================
# 8. FORCE HTTPS (jika sudah punya SSL)
# =============================
RewriteEngine On
RewriteCond %{HTTPS} !=on
RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# =============================
# 9. REMOVE TRAILING SLASH (SEO Friendly, optional)
# =============================
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)/$ /$1 [R=301,L]

# =============================
# 10. BLOCK COMMON EXPLOIT PATTERNS (basic)
# =============================
<IfModule mod_rewrite.c>
  RewriteCond %{QUERY_STRING} (\.\.\/|base64_encode|union.*select|etc\/passwd|\/bin\/bash) [NC]
  RewriteRule .* - [F]
</IfModule>
